<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>보물찾기 등록</title>
    <script>
        function getQueryParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        document.addEventListener("DOMContentLoaded", function() {
            let qrCode = getQueryParam("qr");
            if (!qrCode) {
                alert("잘못된 접근입니다! QR 코드로 접속하세요.");
                document.getElementById("submitBtn").disabled = true; // 버튼 비활성화
            } else {
                document.getElementById("qrCode").value = qrCode;
            }
        });

        function submitForm(event) {
            event.preventDefault();

            let scriptUrl = "https://script.google.com/macros/s/AKfycbzhZ-EeIGfBF8oGNlhirVXFlv8OEskOwiimnexHLUOzI_qnjN5Z1SrLs_d-mo7aphCz/exec"; // 업데이트된 URL
            let qrCode = document.getElementById("qrCode").value;
            let studentId = document.getElementById("studentId").value.trim();
            let name = document.getElementById("name").value.trim();
            let fullName = `${studentId} ${name}`;

            if (!studentId || !name) {
                alert("학번과 이름을 입력하세요!");
                return;
            }

            let formData = new FormData();
            formData.append("qrCode", qrCode);
            formData.append("name", fullName);

            fetch(scriptUrl, {
                method: "POST",
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === "success") {
                    alert("제출되었습니다!");
                    document.getElementById("studentId").value = "";
                    document.getElementById("name").value = "";
                } else {
                    alert(data.message);
                }
            })
            .catch(error => console.error("오류 발생:", error));
        }
    </script>
</head>
<body>
    <h2>보물찾기 등록</h2>
    <form id="dataForm" onsubmit="submitForm(event)">
        <label>QR 코드:</label>
        <input type="text" id="qrCode" name="qrCode" readonly>
        <br>
        <label>학번:</label>
        <input type="text" id="studentId" name="studentId" placeholder="학번 (예: 11503)" required>
        <br>
        <label>이름:</label>
        <input type="text" id="name" name="name" placeholder="이름 (예: 홍길동)" required>
        <br>
        <button type="submit" id="submitBtn">제출</button>
    </form>
</body>
</html>
